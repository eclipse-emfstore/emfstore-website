<div id="midcolumn">
<h2>How to configure the EMF Store</h2>
<p> 
All about the configuration of EMFStore. 
</p>

<b>Data Storage Configuration</b>
<p>By default EMFStore will store its data in the user home in the &quot;.emfstore&quot; folder in a subfolder called &quot;server&quot;. To change this behavior you can configure the following start-up parameter: -EMFStoreHome=&lt;your new path&gt; </p>

<h2>Note about ports</h2>
<p>EMFStore can run with  XML-RPC. XML-RPC was introduced to be able to run via HTTPS and therefore work in firewalled environments. HTTPS known port lies on 443, this causes a problem for the EMFStore on Unix based systems (e.g. Linux and Mac OS). These operating systems only allow low port numbers (&lt;1024) if the process has root access. Because we wanted to avoid giving the server root access, we decided to use rerouting of the port. So we reroute port 443 to 8443 for example and EMFStore then listens on 8443. </p>
<p>System administrators should know how to do this, but if you want to try it out, here are the command lines (replace the IP with your adress): </p>
<p>Mac OS
<pre>$ sudo ipfw add forward 123.123.123.123,8443 \
   ip from any to 123.123.123.123 443</pre>
</p>
<p>Linux
<pre>$ sudo iptables -t nat -A PREROUTING -p tcp --dport 443 \
   -j REDIRECT --to-port 8443</pre>
</p>

<h2>Configuration File</h2>
<p>
If you need to adapt the default configuration of EMFStore you have to create a configuration file called <strong>es.properties</strong>. 
EMFStore will look for this file under the following path: <pre>{user-folder}/.emfstore/server/profiles/default/conf/es.properties </pre>
</p>
<p>In this file you can use the default java propeties syntax to define your options. Below there will be a sample es.properties file explaining all possible configurations: </p>
<div class="properties" style="overflow:auto">
<span class="co1"># Copyright (c) 2008-2010 Jonas Helming, Maximilian Koegel. All rights reserved. This program and the</span><br />
<span class="co1"># accompanying materials are made available under the terms of the Eclipse Public License v1.0 which accompanies this</span><br />
<span class="co1"># distribution, and is available at http://www.eclipse.org/legal/epl-v10.html</span><br />
<span class="co1">#</span><br />
<span class="co1">#</span><br />
<span class="co1"># EMFStore property file: es.properties</span><br />

<span class="co1"># with descriptions</span><br />
<span class="co1">#</span><br />
<span class="co1"># Version of file: 5.1</span><br />
<span class="co1"># Last Update: 16.03.2010</span><br />
<span class="co1"># Author(s): Otto von Wesendonk</span><br />
<span class="co1">#</span><br />
<br />
<span class="co1"># THIS ES.PROPERTIES FILE WAS AUTOMATICALLY COPIED INTO YOUR CONFIG PATH BECAUSE THERE WAS NO OTHER PROPERTY FILE FOUND.</span><br />
<br />
<span class="co1"># EMFStore is able to run without this configuration file. The default values are displayed for every option.</span><br />

<br />
<span class="co1"># Some options differ if the server is running as released version [RV] or is running as a developer version [DV]</span><br />
<br />
<span class="co1"># This file will be processed by the default java properties api. Therefore the syntax for options is:</span><br />
<span class="co1"># &quot;option.key = value&quot;. If multiple values are allowed, separate them with &quot;,&quot;. &quot;option.key = value1,value2&quot;</span><br />
<br />
<br />
<span class="co1">#</span><br />

<span class="co1"># Version</span><br />
<span class="co1">#</span><br />
<br />
<span class="co1"># Use this property do define accepted version numbers. For the server, version numbers only are strings, so you can define</span><br />
<span class="co1"># your format as you wish. You can define several version numbers at the same time seperating them with a &quot;,&quot;</span><br />
<span class="co1"># With the keyword &quot;any&quot; all versions are accepted, this should be used for developement only.</span><br />
<span class="co1"># Options: Multiple values seperate by &quot;,&quot;</span><br />

<span class="co1"># Default: [RV] no value, server won't accept any call. [DV] if no value is specified, &quot;any&quot; is used, otherwise </span><br />
<span class="co1"># the specified values are checked</span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.acceptedversions</span><span class="sy0">=</span><span class="re1">any</span><br />
<br />
<br />
<span class="co1">#</span><br />

<span class="co1"># Persistence</span><br />
<span class="co1">#</span><br />
<br />
<span class="co1">#</span><br />
<span class="co1">#emfstore.persistence.version.projectstate</span><br />
<br />
<span class="co1"># EMFStore mainly saves operations in it's versions. For backup reasons however, every X versions the total project state </span><br />
<span class="co1"># is saved into &nbsp;a file. This options allows to specify how often a complete &nbsp;project state should be saved. If the range is too </span><br />
<span class="co1"># small a lot of memory is used.</span><br />

<span class="co1"># Options: Number bigger than 0</span><br />
<span class="co1"># Default: &quot;1&quot; - every state is preserved. Shouldn't be used if server is deployed</span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.persistence.version.projectstate.everyxversions</span> <span class="sy0">=</span><span class="re1"> 50</span><br />
<br />
<span class="co1"># Deprecated, not in use anymore.</span><br />

<span class="co1"># emfstore.persistence.version.backup.projectstate.everyxversions = 10</span><br />
<br />
<br />
<span class="co1">#</span><br />
<span class="co1"># Validation</span><br />
<span class="co1">#</span><br />
<br />
<span class="co1"># Defines whether the projects on the server shall run through validation. </span><br />
<span class="co1"># Validation is used to confirm the consistency of the saved projects and models.</span><br />
<span class="co1"># Options: &quot;true&quot; or &quot;false&quot;</span><br />

<span class="co1"># Default: &quot;true&quot;</span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.validation</span> <span class="sy0">=</span><span class="re1"> true</span><br />
<br />
<span class="co1"># Defines level of validation. At the moment there are 3 kinds of validation, which can be combined by adding them bitwise.</span><br />
<span class="co1"># Level 1: Loading all files and loading their models and cross-file links.</span><br />
<span class="co1"># Level 2: Checks whether every modelelement and change operation has modelelement id</span><br />

<span class="co1"># Level 4: Applies all changes between to projectstates and compares whether calculated projet state and the actual projectstate are equal.</span><br />
<span class="co1"># Options: Any level or their bitwise combination. E.g. the default value 7 is a combination of all other levels: 1 &amp; 2 &amp; 4 = 7. </span><br />
<span class="co1"># If only want to use the first both level, choose 3 = 1 &amp; 2.</span><br />
<span class="co1"># Default: 7 </span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.validation.level</span> <span class="sy0">=</span><span class="re1"> 7</span><br />

<br />
<span class="co1"># You can exclude certain projects from the validation. It is not possible to exclude projects from _Level 1_ validation</span><br />
<span class="co1"># Options: Multiple Project IDs seperated by &quot;,&quot;</span><br />
<span class="co1"># Default: Not set</span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.validation.exclude</span> <span class="sy0">=</span> <br />
<br />
<br />

<br />
<span class="co1">#</span><br />
<span class="co1"># Connection related options</span><br />
<span class="co1">#</span><br />
<br />
<span class="co1"># At the moment EMFStore runs with RMI and XML RPC in parallel. So you can use both technologies for the connection.</span><br />
<span class="co1"># XML RPC is suggested for enviroments with strict firewalls, because it runs via HTTPS.</span><br />
<br />
<span class="co1"># Defines whether RMI should use SSL encryption or not. Please Note: The password is always encrypted with the server certificate,</span><br />
<span class="co1"># this &quot;only&quot; indicates whether all data is encrypted additionally.</span><br />

<span class="co1"># Options: &quot;true&quot; or &quot;false&quot;</span><br />
<span class="co1"># Default: &quot;true&quot;</span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.connection.rmi.encryption</span> <span class="sy0">=</span><span class="re1"> true</span><br />

<br />
<span class="co1"># Defines the Port for the XML RPC server. Normally we want to use the &quot;442&quot; HTTPS port. However, on Linux/Unix based systems</span><br />
<span class="co1"># lower ports (&lt;1024) are restricted. One workaround for these operating systems ist to listen on higher port and to setup </span><br />
<span class="co1"># a port forward from 443 to the specified port.</span><br />
<span class="co1"># Options: Any possible port</span><br />
<span class="co1"># Default: [RV] &quot;443&quot;, [DV] &quot;8080&quot;</span><br />

<span class="co1">#</span><br />
<span class="re0">emfstore.connection.xmlrpc.port</span><span class="sy0">=</span><span class="re1"> 8080</span><br />
<br />
<br />
<span class="co1">#</span><br />
<span class="co1"># Certificates</span><br />
<span class="co1">#</span><br />
<br />
<span class="co1"># These options are used to handle the server's keystore. the keystore file is located in the main EMFStore folder.</span><br />

<span class="co1"># When deploying you should generate an own certificate and don't use the default developer certificate</span><br />
<br />
<span class="co1"># Defines the alias of the main server certificate stored in the keystore.</span><br />
<span class="co1"># Options: any alias allowed in the keystore</span><br />
<span class="co1"># Default: dependent of the used certificate</span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.keystore.alias</span> <span class="sy0">=</span><span class="re1"> emfstoreServer</span><br />

<br />
<span class="co1"># Password for the selected certificate.</span><br />
<span class="co1"># Options: any password</span><br />
<span class="co1"># Default: dependent of the used certificate</span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.keystore.password</span> <span class="sy0">=</span><span class="re1"> 123456</span><br />
<br />
<span class="co1"># Defines the used certificate type stored in the keystore</span><br />

<span class="co1"># Options: All Certificates which are supported by the java keystore</span><br />
<span class="co1"># Default: &quot;SunX509&quot;</span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.keystore.certificate.type</span><span class="sy0">=</span><span class="re1"> SunX509</span><br />
<br />
<span class="co1"># Defines the used cipher algorithm for the certificate</span><br />
<span class="co1"># Options: All cipher algorithms supported by the java api</span><br />

<span class="co1"># Default: &quot;RSA&quot;</span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.keystore.cipher.algorithm</span><span class="sy0">=</span><span class="re1">RSA</span><br />
<br />
<br />
<span class="co1">#</span><br />
<span class="co1"># Authentication</span><br />
<span class="co1">#</span><br />

<br />
<span class="co1"># Defines the name of the super user. The super user will be created on server startup if not present.</span><br />
<span class="co1"># If the super user is deleted while runtime, you have to restart the server in order to restor it.</span><br />
<span class="co1"># Options: Any name</span><br />
<span class="co1"># Default: &quot;super&quot;</span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.accesscontrol.authentication.superuser</span> <span class="sy0">=</span><span class="re1"> super</span><br />

<br />
<span class="co1"># The password for the super user account.</span><br />
<span class="co1"># Options: Any password</span><br />
<span class="co1"># Default: &quot;super&quot;</span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.accesscontrol.authentication.superuser.password</span> <span class="sy0">=</span><span class="re1"> super</span><br />
<br />

<span class="co1"># Defines the session timeout for a user session. If a session is inactive for this period of time, the session will be destroyed.</span><br />
<span class="co1"># Options: A number specifiing the time in milliseconds</span><br />
<span class="co1"># Default: &quot;1800000&quot; (= 30 minutes)</span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.accesscontrol.session.timeout</span><span class="sy0">=</span><span class="re1"> 1800000</span><br />
<br />

<br />
<span class="co1"># Defines the policy for user authentication. EMFStore doesn't store any password and uses external resources for authentication.</span><br />
<span class="co1"># In order to create a new user, the user has to be created within the EMFStore with a specified user name.</span><br />
<span class="co1"># The authentication method uses this name and validates the password against the specified authentication adapter</span><br />
<span class="co1"># Options: &quot;spfv&quot; or &quot;ldap&quot; (explenations beneath)</span><br />
<span class="co1"># Default: &quot;spfv&quot;</span><br />

<span class="co1">#</span><br />
<span class="re0">emfstore.accesscontrol.authentication.policy</span><span class="sy0">=</span><span class="re1">spfv</span><br />
<br />
<span class="co1"># SPFV (Simple property file verification) is a simple mechanism to store user passwords. It's only intended for development purposes.</span><br />
<span class="co1"># It uses the java properties api and the format for passwords are: &quot;username=userpassword&quot; in each line</span><br />
<span class="co1"># The default location for this file is {user-folder}/.emfstore/emfstore/conf/user.properties</span><br />
<br />

<span class="co1"># Defines the location of the spfv file.</span><br />
<span class="co1"># Options: OS dependent path to file, absolute or relative.</span><br />
<span class="co1"># Default: Not set (= than uses the default location)</span><br />
<span class="co1">#</span><br />
<span class="co1">#emfstore.accesscontrol.authentication.spfv = /your/path/</span><br />
<br />
<span class="co1"># If you are using LDAP, you have to specify the server's location. EMFStore can cope with several LDAP server at once.</span><br />
<span class="co1"># The server will try to authenticate against each server until the authentication was successful, otherwise the authentication fails</span><br />
<span class="co1"># For each LDAP server there are 3 necessary options, all prefixed with the server's index</span><br />

<span class="co1"># Indexes start with 1 and you can add more by counting up. You shouldn't have a gap in your indexes, otherwise the server will stop lookinf for further LDAP servers.</span><br />
<span class="co1"># Also if a configuration is empty, the server will stop looking for further configurations.</span><br />
<span class="co1"># Options: LDAP configuration specifying &quot;url&quot;, &quot;base&quot; and &quot;searchdn&quot;</span><br />
<span class="co1"># Default: Not set</span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.accesscontrol.authentication.ldap.1.url</span><span class="sy0">=</span><span class="re1">ldap://ldap1.in.tum.de:389</span><br />

<span class="re0">emfstore.accesscontrol.authentication.ldap.1.base</span><span class="sy0">=</span><span class="re1">ou=Personen,ou=IN,o=TUM,c=DE</span><br />
<span class="re0">emfstore.accesscontrol.authentication.ldap.1.searchdn</span><span class="sy0">=</span><span class="re1">uid</span><br />
<br />
<span class="re0">emfstore.accesscontrol.authentication.ldap.2.url</span><span class="sy0">=</span><span class="re1">ldap://ldap2.in.tum.de:389</span><br />
<span class="re0">emfstore.accesscontrol.authentication.ldap.2.base</span><span class="sy0">=</span><span class="re1">ou=Personen,ou=IN,o=TUM,c=DE</span><br />

<span class="re0">emfstore.accesscontrol.authentication.ldap.2.searchdn</span><span class="sy0">=</span><span class="re1">uid</span><br />
<br /><br />
<span class="co1">#</span><br />
<span class="co1"># Plugin configuration.</span><br />
<span class="co1">#</span><br />
<br />
<span class="co1"># Defines whehter post load plugins shall be called or not.</span><br />
<span class="co1"># Options: true or false</span><br />

<span class="co1"># Default: true</span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.startup.post.loadlistener</span> <span class="sy0">=</span><span class="re1"> true</span><br />
<br />
<span class="co1">#</span><br />
<span class="co1"># Deprecated options or options not ment for public use. Please dont change or use these:</span><br />
<span class="co1">#</span><br />

<br />
<span class="co1"># Used for development purposes.</span><br />
<span class="co1">#</span><br />
<span class="re0">emfstore.startup.loadlistener</span> <span class="sy0">=</span><span class="re1"> false</span><br />
<br />
<span class="co1"># EMF resource type for storing data. At the moment only one option is allowed: org.eclipse.emf.emfstore.server.storage.XMLStorage</span><br />
<span class="co1"># emfstore.persistence.resourceStorage = org.eclipse.emf.emfstore.server.storage.XMLStorage</span><br />
</div>

<h2>Creating Keystores for Encryption </h2>
<p>
In order to encrypt the transport layer, both, server and client require a keystore containing the private/public key. 
The server keystore is stored in the EMFStore data directory (default: $HOME/.emfstore/server/profiles/<profilename>). 
The client keystore is stored in the client data directory (default: $HOME/.emfstore/client/profiles/<profilename>). 
Just generate the keys following the documentation and then copy them to the given directories.
</p>
<p>
Let's start with creating the server's keystore and the private key. Therefore we use the keytool distributed with java's jdk. Use the keytool with following parameters:
</p>
<pre>
keytool -genkey -keyalg RSA -keystore emfstoreServer.keystore -alias emfstoreServer
</pre>
<p>
Then follow the instructions.
<b>Note</b>: You have to name your keystore emfstoreServer.keystore, otherwise the server won't find it. Keytool requests a password, this password has to correspond with the keystore password specified in your server configuration.
</p> 
<pre>
C:\Users\User>keytool -genkey -keyalg RSA -keystore emfstoreServer.keystore -alias emfstoreServer
Enter keystore password: 123456
What is your first and last name?
  [Unknown]: John Doe
What is the name of your organization unit?
  [Unknown]: ExampleOrganization
What is the name of your organization?
  [Unknown]: Example
What is the name of your City or Locality?
  [Unknown]: ExampleCity
What is the name of your State or Province?
  [Unknown]: ExampleState
What is the two-letter country code for this unit?
  [Unknown]: EU
Is CN=John Doe, OU=ExampleOrganization, O=Example, L=ExampleCity, ST=ExampleState, C=EU correct?
  [no]: yes
  
Enter key password for <emfstoreServer>
        (RETURN if same as keystore password):  
</pre>
In the next step you have to export the server's public key: 
<pre>
keytool -export -rfc -keystore emfstoreServer.keystore -alias emfstoreServer -file emfstoreServer.public-key 
</pre>
<p>If you want to deploy the client and ship an initial keystore there is one more step left, 
otherwise you can publish the public key and use the - planned - import function of the client.</p>
<p>
To create an initial keystore for the client again use the keytool:
</p>
<pre>
keytool -import -alias "youralias" -keystore emfstoreClient.keystore -file emfstoreServer.public-key
</pre>
and follow the instructions.
<p>
<b>Note</b>: As password for the client's keystore use the password specified in KeyStoreManager in the workspace plugin. And you can use any format for your alias
</p>
<pre>
C:\Users\User>keytool -import -alias "EMFStore Certificate" -keystore emfstoreClient.keystore -file emfstoreServer.public-key
Enter keystore password: 654321
Owner: CN=John Doe, OU=ExampleOrganization, O=Example, L=ExampleCity, ST=ExampleState, C=EU
Issuer: CN=John Doe, OU=ExampleOrganization, O=Example, L=ExampleCity, ST=ExampleState, C=EU
Serial number: 48ef625f
Valid from: Fri Oct 10 16:10:39 CEST 2008 until: Thu Jan 08 15:10:39 CET 2009
Certificate fingerprints:
         MD5: 9D:BD:6B:63:08:9C:37:62:6A:F7:0B:2C:E1:BE:4F:7B
         SHA1: C3:6A:57:86:A0:C4:F4:2D:94:AC:FC:C3:72:18:C7:7C:ED:7A:A9:06
Trust this certificate? [no]:  yes
Certificate was added to keystore
</pre> 
<p>
And then feel safe ;)
</p>
<p>
These certificates are also used to encrypt client's password stored in the user's profile. So only the server is able to decrypt and validate them. This allows to avoid saving them in clear text.
</p> 
</div>

